<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
    <link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/bootstrap-treeview.css" />
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../font-awesome/4.5.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="../../css/css.css" />
    <link rel="stylesheet" href="../../css/zTreeStyle.css" />
    <link href="../../toastr/toastr.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../style/jquery-editable-select.css">

    <link rel="stylesheet" type="text/css" href="../../easyUI/themes/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../../easyUI/themes/icon.css" />
    <link rel="stylesheet" type="text/css" href="../../easyUI/demo/demo.css" />
    <link rel="stylesheet" type="text/css" href="../../css/layui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/layui.mobile.css" />
    <link rel="stylesheet" type="text/css" href="../../css/laydate.css" />
    <link rel="stylesheet" type="text/css" href="../../css/code.css" />
    <link rel="stylesheet" type="text/css" href="../../../js/skin/default/layer.css" />
    <link rel="stylesheet" type="text/css" href="../../css/laydate.css" />
    <link href="../../toastr/toastr.css" rel="stylesheet">
    <!-- SmartAdmin Styles : Caution! DO NOT change the order -->
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production-plugins.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-skins.min.css">
    
    <style lang="">
        .UpperPart{
            display: flex;
            justify-content:space-between;
            border-bottom: 1px solid #ccc;
            padding-bottom: 4px;
        }
        .selected{
            background: rgba(247, 161, 3,0.2);
        }
        #mainContent th{
            cursor: pointer;
        }
    </style>
</head>
<body>

<!-- 面包屑 -->
<div class="mianbao">
    <ul class="breadcrumb">
        <li><i class="iconfont icon-knowledgebase"></i></li>
        <li>系统管理</li>
        <li class="active">角色管理</li>
    </ul>
</div>

<div class="zhuti-content">

    <div>
        <!-- Nav tabs -->
        <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
        <ul class="layui-tab-title" role="tablist" style="background:#fff;margin-top:-10px;">
            <li role="presentation" class="active layui-this"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">人员角色管理</a></li>
            <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">角色管理</a></li>
        </ul>
		</div>
        <!-- Tab panes -->
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="home">
                <div class="UpperPart">
                    <div class="UpperPartL">

                    </div>
                    <div class="UpperPartR">
                        <!-- <button type="button" class="btn btn-primary" >新建人员角色管理</button> -->
                    </div>

                </div>
                <div class="LowerPart" style="margin-top:3px;">
                    <!--  -->
                    <table class="layui-table" lay-skin="line" id="mainContent">
                        <thead>
                        <tr>
                            <th>账号</th>
                            <th>姓名</th>
                            <th>人员角色</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

            </div>
            <!--角色管理  -->
            <div role="tabpanel" class="tab-pane" id="profile">
                <div class="UpperPart">
                    <div class="UpperPartL">

                    </div>
                    <div class="UpperPartR">
                        <button type="button" class="btn btn-primary Phbb" data-toggle="modal" data-target="#myModal2">新建角色管理</button>
                    </div>

                </div>
                <div class="LowerPart" style="margin-top:3px;">
                    <!--  -->
                    <table class="layui-table" lay-skin="line" id="mainContent2">
                        <thead>
                        <tr>
                            <th>角色名称</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>


</div>
<!-- Modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel"><b>分配角色</b></h4>
            </div>
            <div class="modal-body">
                <!--<div class="f-tree"></div>-->
                <div class="zTreeDemoBackground left">
                    <ul id="checkboxTree2" class="ztree"></ul>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" id="savePersonRoles">保存</button>
            </div>
        </div>
    </div>
</div>
<!-- model结束 -->

<!-- Modal2 -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal2">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel"><b>新建角色管理</b></h4>
            </div>
            <div class="modal-body">
                <div>
                    <form class="form-inline">
                        <table class="layui-table" lay-skin="line">
                            <tr>
                                <td>角色名称</td>
                                <td><input type="text" class="form-control" id='inputRoleName'></td>
                                <!--<td>上级角色</td>
                                <td>
                                    <select class="form-control" style="width:180px;" id='parentRole'>
                                    </select>
                                </td>-->
                            </tr>
                            <!--<tr>
                                <td>是否抽象</td>
                                <td>
                                    <select class="form-control" style="width:180px;" id="ifCouXiang">
                                        <option value="0">是</option>
                                        <option value="1">否</option>
                                    </select>
                                </td>
                                <td></td>
                                <td></td>
                            </tr>-->
                        </table>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" id="saveRole">保存</button>
            </div>
        </div>
    </div>
</div>
<!-- model2结束 -->
<!-- Modal2修改 -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="change2">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel"><b>修改角色管理</b></h4>
            </div>
            <div class="modal-body">
                <div>
                    <form class="form-inline">
                        <table class="layui-table" lay-skin="line">
                            <tr>
                                <td>角色名称</td>
                                <td><input type="text" id="xg_inputRoleName" class="form-control"></td>
                                <!--<td>上级角色</td>
                                <td>
                                    <select class="form-control" style="width:180px;">
                                        <option>老板</option>
                                    </select>
                                </td>-->
                            </tr>
                            <!--<tr>
                                <td>是否抽象</td>
                                <td>
                                    <select class="form-control" style="width:180px;">
                                        <option>是</option>
                                        <option>否</option>
                                    </select>
                                </td>
                                <td></td>
                                <td></td>
                            </tr>-->
                        </table>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" id="xg_save">保存</button>
            </div>
        </div>
    </div>
</div>
<!-- model2修改结束 -->
<!-- Modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="change">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel"><b>分配权限</b></h4>
            </div>
            <div class="modal-body">
                <div class="zTreeDemoBackground left">
                    <ul id="checkboxTree" class="ztree"></ul>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" id="savequanxian">保存</button>
            </div>
        </div>
    </div>
</div>
<!-- model结束 -->

</body>
<script src="../../js/jquery.js"></script>
<script src="../../easyUI/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../easyUI/jquery.easyui.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/jquery.dataTables.min.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<script src="../../js/main.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/bootstrap-treeview.js" ></script>
<script src="../../js/tree.min.js"></script>
<script src="../../js/layui.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/element.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/echarts.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../toastr/toastr.js"></script>
<script src="../../js/jquery.ztree.core.js"></script>
<script src="../../js/jquery.ztree.excheck.js"></script>
<script type="text/javascript" src="../../js/config.js" ></script>
<script type="text/javascript" src="../../js/data.js" ></script>
<script src="../../js/SmartNotification.min.js"></script>
<script src="../../js/myTool.js"></script>
<script src="../../js/quanxian.js"></script>
<script src="../../js/myTool.js"></script>
<script src="../../js/myEcharts.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.staticfile.org/vue-resource/1.5.1/vue-resource.min.js"></script>
<script>
    $(document).ready( function () {

        selectUserAndRoles();
        initTable2()
        /*fzTree = $.fn.zTree.init($("#checkboxTree"),setting, zNodes);*/
    });
    var setting = {
        view: { selectedMulti: true , showIcon:false },
        check: { enable: true,  chkStyle: "checkbox" /* chkboxType :{ "Y" : "p", "N" : "s" } */ },
        data : { simpleData : { enable : true},
            keep: {parent: false,leaf:false}
        },
        async: { enable: true},
        callback:{
            beforeCheck:true,
            onCheck:onCheck
        }
    },zTree;

    var setting2 = {
        view: { selectedMulti: true , showIcon:false },
        check: { enable: true,  chkStyle: "checkbox" /* chkboxType :{ "Y" : "p", "N" : "s" } */ },
        data : { simpleData : { enable : true},
            keep: {parent: false,leaf:false}
        },
        async: { enable: true},
        callback:{
            beforeCheck:true,
            onCheck:onCheck2
        }
    },zTree;

    var table=$('#mainContent').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
            "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
        },
        "columns": [
            { "data": "username"},
            { "data": "uName"},
            { "data": "userRoleNames"},
            { "data": null},
            {"data":"userId","visible": false},
            {"data":"userRole","visible": false},
        ],
        "columnDefs": [
            {
                "class": "tcenter",
                "targets": 3,
                "searchable": true,
                "render": function(data, type, full) {

                    return '<span class="glyphicon glyphicon-check zhuashou Phba" aria-hidden="true"  style="font-size:18px;display:none;" title="分配角色" data-id="'+data.userRole+'" data-uid="'+data.userId+'" data-toggle="modal" data-target="#myModal" onclick="initRoleListById(this)"></span>'
                }
            }
        ],"fnDrawCallback" : function() {
            initTableQuanxian()
        },
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
            "sProcessing": "正在获取数据，请稍后...",
            "sLengthMenu": "显示 _MENU_ 条",
            "sZeroRecords": "查询不到相关数据",
            "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
            "sInfoEmpty": "记录数为0",
            "sInfoFiltered": "(全部记录数 _MAX_ 条)",
            "sInfoPostFix": "",
            "sSearch": "搜索",
            "sUrl": "",
            "oPaginate": {
                "sFirst": "第一页",
                "sPrevious": "上一页",
                "sNext": "下一页",
                "sLast": "最后一页"
            }},

    });
    var table=$('#mainContent2').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
            "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
        },
        "columns": [
            { "data": "roleName"},
            { "data": null},
        ],
        "columnDefs": [
            {
                "class": "tcenter",
                "targets": 1,
                "searchable": true,
                "render": function(data, type, full) {
                    var xiugai= ' <i class="iconfont icon-xiugai Phbc" style="font-size:18px;cursor:pointer;display:none;" title="修改角色" onclick="xiugai(this)" data-toggle="modal" data-target="#change2" id="Changedanwei"></i>'
                    var fenpeiquanxian= '<span class="glyphicon glyphicon-check zhuashou Phbd" aria-hidden="true"  style="font-size:18px;display:none;" title="分配权限"  data-toggle="modal" data-target="#change" onclick="updateQuanxian(this)"></span>'
                    return xiugai+fenpeiquanxian;
                }
            }
        ],"fnDrawCallback" : function() {
            initTableQuanxian()
        },
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
            "sProcessing": "正在获取数据，请稍后...",
            "sLengthMenu": "显示 _MENU_ 条",
            "sZeroRecords": "查询不到相关数据",
            "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
            "sInfoEmpty": "记录数为0",
            "sInfoFiltered": "(全部记录数 _MAX_ 条)",
            "sInfoPostFix": "",
            "sSearch": "搜索",
            "sUrl": "",
            "oPaginate": {
                "sFirst": "第一页",
                "sPrevious": "上一页",
                "sNext": "下一页",
                "sLast": "最后一页"
            }},

    });

    function initTableQuanxian(){
        $.ajax({
            type:"post",
            url:"/login/getUser",
            async:false,
            data:{
            },
            success:function(json){
                if(json!=null &&json!=""){
                    var arr = json.uPermissions.split(',');
                    for(var i=0;i<arr.length;i++){
                        var arr2 = arr[i].replace("+","");
                        if(arr[i].indexOf("Phba") >= 0 ){
                            $(".Phba").show();
                        }
                        if(arr[i].indexOf("Phbc") >= 0 ){
                            $(".Phbc").show();
                        }
                        if(arr[i].indexOf("Phbd") >= 0 ){
                            $(".Phbd").show();
                        }
                    }

                }

            }
        });
    }

    function initTable(){
        //var base64 = new Base64();
        $.ajax({
            type: 'POST',
            url: '/user/selectAllUser',
            data: {
            },
            success: function (json) {
               // var arr = base64.decode(data);
                //json = JSON.parse(arr);
                $('#mainContent').dataTable().fnClearTable();
                $('#mainContent').DataTable().rows.add(json).draw(false);
            }
        });
    }
    function initTable2(){
        $.ajax({
            type: 'POST',
            url: '/URole/selectRolesSort',
            data: {
            },
            success: function (json) {
                $('#mainContent2').dataTable().fnClearTable();
                $('#mainContent2').DataTable().rows.add(json).draw(false);
            }
        });
    }

    var xgId;
    function  xiugai(obj) {
        var dom=$(obj).parents("tr");
        var data=$("#mainContent2").DataTable().row(dom).data();
        xgId=data.id;
        $("#xg_inputRoleName").val(data.roleName)
    }

    $("#xg_save").click(function(){
        var xg_inputRoleName=$("#xg_inputRoleName").val();
        $.ajax({
            type: 'POST',
            url: '/URole/updURoleVoById',
            dataType: 'json',
            data: {
                id:xgId,
                roleName:xg_inputRoleName,
            },
            error: function (msg) {
                alert("请求失败");
            },
            success: function (json) {
                $("#change2").modal('hide');
                initTable2();
                initTableQuanxian()
            }
        });
    })


    var jiaoseId;
    function updateQuanxian(obj){

        $.ajax({
            type: 'POST',
            url: '/UPermissionsRole/getAllUPermissionsRole',
            dataType: 'json',
            data: {
            },
            error: function (msg) {
                alert("请求失败");
            },
            success: function (json) {
                zNodes=[];
                var arr1 = json.list1;
                var pId1=[];
                if(arr1!=null&&arr1.length>0){
                    for(var i in arr1){
                        pId1[i]=arr1[i].coding;
                        var a  = {};
                        a.id=arr1[i].coding;
                        a.pId = 0;
                        a.name=arr1[i].name;
                        a.open=false
                        zNodes.push(a);
                    }
                }
                var arr2 = json.list2;
                var pId2=[];
                for(var j in pId1){
                    if(arr2!=null&&arr2.length>0){
                        for(var k in arr2){
                            if(arr2[k].coding.substr(0,2)==pId1[j].substr(0,2)){
                                pId2[k]=arr2[k].coding;
                                var b  = {};
                                b.id=arr2[k].coding;
                                b.pId = pId1[j];
                                b.name=arr2[k].name;
                                zNodes.push(b);

                            }
                        }
                    }
                }
                var arr3 = json.list3;
                var pId3=[];
                for(var n in pId2){
                    if(arr3!=null&&arr3.length>0){
                        for(var m in arr3){
                            var cal=arr3[m].coding;
                            if(cal.substr(0,3)==pId2[n].substr(0,3)){
                                pId3[m]=arr3[m].coding;
                                var c  = {};
                                c.id=arr3[m].coding;
                                c.pId = pId2[n];
                                c.name=arr3[m].name;
                                zNodes.push(c);
                            }
                        }

                    }
                }
                var arr4 = json.list4;
                var pId4=[];
                for(var ii in pId3){
                    if(arr4!=null&&arr4.length>0){
                        for(var jj in arr4){
                            var val=arr4[jj].coding
                            if(val.substr(0,4)==pId3[ii].substr(0,4)){
                                pId4[jj]=arr4[jj].coding;
                                var d = {};
                                d.id=arr4[jj].coding;
                                d.pId = pId3[ii];
                                d.name=arr4[jj].name;
                                zNodes.push(d);

                            }
                        }
                    }
                }
                var arr5 = json.list5;
                var pId5=[];
                for(var mm in pId4){
                    if(arr5!=null&&arr5.length>0){
                        for(var nn in arr5){
                            if(arr5[nn].coding.substr(0,5)==pId4[mm].substr(0,5)){
                                pId5[nn]=arr5[nn].coding;
                                var e = {};
                                e.id=arr5[nn].coding;
                                e.pId = pId4[mm];
                                e.name=arr5[nn].name;
                                zNodes.push(e);

                            }
                        }
                    }
                }
                $.fn.zTree.init($("#checkboxTree"),setting, zNodes);

                var dom=$(obj).parents("tr");
                var data=$("#mainContent2").DataTable().row(dom).data();
                jiaoseId=data.id;
                var roleCode=data.uPersmissionCoding;
                var zTree = $.fn.zTree.getZTreeObj("checkboxTree");//treeDemo界面中加载ztree的div
                zTree.cancelSelectedNode();//先取消所有的选中状态
                if(roleCode!=null&&roleCode!=''){
                    var arr=roleCode.split(',');
                    for(var i=0;i<arr.length;i++){
                        zTree.checkAllNodes(false);
                        var id = arr[i];
                        var node = zTree.getNodeByParam("id",id);
                        if(node!=null){
                            zTree.checkNode(node,false);//将指定ID的节点取消选中
                        }
                    }
                    for(var i=0;i<arr.length;i++){
                        var id = arr[i];
                        var node = zTree.getNodeByParam("id",id);
                        if(node!=null){
                            zTree.checkNode(node,true);//将指定ID的节点选中
                        }
                        //zTree.expandNode(node, true, false);//将指定ID节点展开

                    }

                }else{
                    zTree.checkAllNodes(false);
                }
            }
        });

    }

    var roleCode;
    function onCheck(e,treeId,treeNode){
        var treeObj=$.fn.zTree.getZTreeObj("checkboxTree"),
            nodes=treeObj.getCheckedNodes(true),
            v="";
        var arr = [];
        for(var i=0;i<nodes.length;i++){
            v+=nodes[i].name + ",";
            arr[i]=nodes[i].id;
            //console.log("节点id:"+nodes[i].id+"节点名称"+v); //获取选中节点的值
        }
        roleCode = arr.join(',');
        //console.log(permissions)
    }
    var roleCode2;
    function onCheck2(e,treeId,treeNode){
        var treeObj=$.fn.zTree.getZTreeObj("checkboxTree2"),
            nodes=treeObj.getCheckedNodes(true),
            v="";
        var arr = [];
        for(var i=0;i<nodes.length;i++){
            v+=nodes[i].name + ",";
            arr[i]=nodes[i].id;
            //console.log("节点id:"+nodes[i].id+"节点名称"+v); //获取选中节点的值
        }
        roleCode2 = arr.join('_');
    }

    $("#savequanxian").click(function(){
        $.ajax({
            type: 'POST',
            url: '/URole/upduPersmissionCoding',
            dataType: 'json',
            data: {
                id:jiaoseId,
                uPersmissionCoding:roleCode
            },
            success: function (json) {
                if(json>0){
                    toastr.success("修改成功");
                    $("#change").modal("hide")
                    initTable2();
                    initTableQuanxian()
                }else{
                    toastr.error("修改失败")
                }
            }
        });
    })


    var pageUId ;
    function initRoleListById(dom){
        var obj=$(dom).parents("tr");
        var data=$("#mainContent").DataTable().row(obj).data();
        pageUId=undefined;
        var userRole = $(dom).attr("data-id");
        var checkArray = userRole.split("_")
        pageUId = $(dom).attr("data-uid");
        $.ajax({
            type: 'POST',
            url:'/URole/initRoleListById',
            dataType: 'json',
            data: {
            },
            error: function (msg) {
                toastr.error("请求失败");
            },
            success: function (json) {
                var json = json;
                zNodes2=[];
                for(var i in json){
                    var e = {};
                    e.id=json[i].roleCode;
                    e.pId = 0;
                    e.name=json[i].text;
                    e.open=false;
                    zNodes2.push(e);
                }
                $.fn.zTree.init($("#checkboxTree2"),setting2, zNodes2);

                var roleCode=data.userRole;
                var zTree = $.fn.zTree.getZTreeObj("checkboxTree2");//treeDemo界面中加载ztree的div
                zTree.cancelSelectedNode();//先取消所有的选中状态
                if(roleCode!=null&&roleCode!=''){
                    var arr=roleCode.split('_');
                    for(var i=0;i<arr.length;i++){
                        zTree.checkAllNodes(false);
                        var id = arr[i];
                        var node = zTree.getNodeByParam("id",id);
                        if(node!=null){
                            zTree.checkNode(node,false);//将指定ID的节点取消选中
                        }
                    }
                    for(var i=0;i<arr.length;i++){
                        var id = arr[i];
                        var node = zTree.getNodeByParam("id",id);
                        if(node!=null){
                            zTree.checkNode(node,true);//将指定ID的节点选中
                        }
                        //zTree.expandNode(node, true, false);//将指定ID节点展开
                    }

                }else{
                    zTree.checkAllNodes(false);
                }

            }
        });

    }

    $("#savePersonRoles").bind('click',function(){
        $.ajax({
            type: 'POST',
            url: '/URole/updateParentRole',
            dataType: 'json',
            data: {
                personId:pageUId,
                personRoles:roleCode2
            },
            error: function (msg) {
                toastr.error("请求失败");
            },
            success: function (json) {
                if(json>0){
                    toastr.success("修改成功");
                    $("#myModal").modal('hide');
                    selectUserAndRoles();
                }
            }
        });
    })



    /*function initParentRole(){
        $.ajax({
            type: 'POST',
            url:'/URole/getParentRoles',
            dataType: 'json',
            data: {
            },
            error: function (msg) {
                toastr.error("请求失败");
            },
            success: function (json) {
                var json = json;
                $("#parentRole").empty();
                $("#parentRole").append("<option value='0'>无</option>");
                for(var i=0;i<json.length;i++){
                    $("#parentRole").append("<option value='"+json[i].roleCode+"'>"+json[i].roleName+"</option>");
                }
            }
        });
    }*/
    $("#saveRole").bind("click",function(){
        var inputRoleName = $("#inputRoleName").val();
        //var parentRole = $("#parentRole").val();
        //var ifCouXiang = $("#ifCouXiang").val();
        $.ajax({
            type: 'POST',
            url: '/URole/addRole',
            dataType: 'json',
            data: {
                inputRoleName:inputRoleName,
                //parentRole:parentRole,
                //ifCouXiang:ifCouXiang
            },
            error: function (msg) {
                alert("请求失败");
            },
            success: function (json) {
                $("#myModal2").modal('hide');
                initTable2();
            }
        });
    })
    function selectUserAndRoles(){
        //var base64 = new Base64();
        $.ajax({
            type: 'POST',
            url: '/user/selectUserAndRoles',
            data: {
            },
            error: function (msg) {
                toastr.error("请求失败");
            },
            success: function (json) {
                //var arr = base64.decode(data);
                //json = JSON.parse(arr);
                $('#mainContent').dataTable().fnClearTable();
                $('#mainContent').DataTable().rows.add(json).draw(false);
            }
        });
    }






</script>
</html>