<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title></title>
<link href="../../favicon.ico" rel="shortcut icon">
<link href="../../style/bootstrap.min.css" rel="stylesheet">
<link href="../../style/style.css" rel="stylesheet">
<link href="../../toastr/toastr.css" rel="stylesheet">
<link rel="stylesheet" href="../../font2/iconfont.css">
<link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
<link rel="stylesheet" type="text/css" href="../../easyUI/themes/default/easyui.css" />
<link rel="stylesheet" type="text/css" href="../../easyUI/themes/icon.css" />
<link rel="stylesheet" type="text/css" href="../../easyUI/demo/demo.css" />
<link rel="stylesheet" type="text/css" href="../../css/layui.css" />
<link rel="stylesheet" type="text/css" href="../../css/layui.mobile.css" />
<link rel="stylesheet" type="text/css" href="../../css/laydate.css" />
<link rel="stylesheet" type="text/css" href="../../css/code.css" />
<link rel="stylesheet" type="text/css" href="../../../js/skin/default/layer.css" />
<link rel="stylesheet" type="text/css" href="../../css/laydate.css" />
<!-- SmartAdmin Styles : Caution! DO NOT change the order -->
<link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production-plugins.min.css">
<link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production.min.css">
<link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-skins.min.css">
<link rel="stylesheet" type="text/css" media="screen" href="../../css/font.css">
<!-- SmartAdmin RTL Support  -->
<link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-rtl.min.css">
<style lang="">
    .UpperPart{
        display: flex;
        justify-content:space-between;
        border-bottom: 1px solid #ccc;
        padding-bottom: 12px;
    }
    .selected{
        background: rgba(247, 161, 3,0.2);
    }
    #mainContent th{
        cursor: pointer;
    }
</style>
</head>
<body>
	
<div class="layui-tab">
	<ul class="layui-tab-title">
		<li class="layui-this">摊铺里程列表</li>
		<li>摊铺里程统计</li>
		<li>逐标段摊铺里程统计</li>
	</ul>
	<div class="UpperPart">
		
	</div>
	<div class="layui-tab-content">
		<div class="layui-tab-item layui-show">
			<div class="UpperPart">
					<div class="UpperPartL">
						<button type="button" class="btn btn-primary Peada" data-toggle="modal" data-target="#myModal" style="margin: 5PX;">录入摊铺里程</button>
					</div>
					<div class="UpperPartR">
						<!--<button type="button" class="btn btn-primary" style="margin: 5PX;">导出Excel文件</button>-->
					</div>
			</div>
			<div class="bottom">
				<!--<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal" style="margin: 5PX;float: left;">录入</button>-->
				<table class="table table-bordered table-condensed" id="mainContent">
					<thead>
						<tr>
							<th>路段名称</th>
							<th>标段号</th>
							<th>摊铺里程</th>
							<th>施工时间</th>
							<th>操作人员</th>
							<th style="width:70px;">操作</th>
						</tr>
					</thead>
					<tbody>

					</tbody>
				</table>
			</div>
		</div>
		<div class="layui-tab-item">
			<!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
				<div id="sec" style="width: 1000px;height:400px;"></div>        
		</div>
		<div class="layui-tab-item">
			<div id="fou" style="width: 1000px;height:400px;"></div>        
		</div>
	</div>
</div>
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="allMsg1">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>所有信息</b></h4>
        </div>
        <div class="modal-body">
            <div>     
                <form class="form-inline">
                    <table class="table table-bordered">
                       <tr>
                       	<td style="width: 20%;">序号</td>
                       	<td style="width: 30%;">1</td>
                       	<td style="width: 20%;">路段编号</td>
                       	<td style="width: 30%;">1</td>
                       </tr>
                       <tr>
                       	<td>摊铺里程</td>
                       	<td>1</td>
                       	<td>施工时间</td>
                       	<td>2019-10-10 10:10:10</td>
                       </tr>
                       <tr>
                        <td></td>
                       	<td>1</td>
                       	<td></td>
                       	<td></td>
                       </tr>
                    </table>
                </form>  
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content" id="luruDiv">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title" id="myModalLabel"><b>录入摊铺速度里程</b></h4>
		</div>
		<div class="modal-body">
				<div>     
					<form class="form-inline">
						<table class="table table-bordered">
							<tr>
								<td>路段编号</td>
								<td>
                                    <select class="form-control" @change="roadChange" v-model="roadSelected" style="width: 100%;" id="roadid">
                                        <option :value="road.roadid" v-for="road in roadList">{{road.roadname}}</option>
                                    </select></td>
                                <td>路段号</td>
                                <td>
                                    <select class="form-control" style="width: 100%;" v-model="siteId=roadSelected2"  id="roadnumber">
                                        <option :value="road.id" v-for="road in roadList2">{{road.sitenumber}}</option>
                                    </select>
                                </td>

							</tr>
							<tr>
                                <td>施工时间</td>
                                <td>
									<input type="text" class="form-control"  v-model="datetime" id="datetime" placeholder="请输入"style="width: 100%; height: 100%; border: none;">
								</td>
								<td>摊铺里程</td>
								<td>
									<input type="text" class="form-control" v-model="length" id="length" placeholder="请输入"style="width: 100%; height: 100%; border: none;">
								</td>
							</tr>
						</table>
					</form> 
				</div>
		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			<button type="button" class="btn btn-success" @click="save">保存</button>
		</div>
		</div>
	</div>
</div>
<!-- model结束 -->

<!-- 修改Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="change">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title" id="myModalLabel"><b>修改摊铺速度里程</b></h4>
		</div>
		<div class="modal-body">
			<div>     
				<form class="form-inline">
					<table class="table table-bordered">
						<tr>
							<td>路段编号</td>
							<td>
								<select class="form-control" @change="roadChange" v-model="roadSelected" style="width: 100%;" id="roadid">
									<option :value="road.roadid" v-for="road in roadList">{{road.roadname}}</option>
								</select></td>
							<td>路段号</td>
							<td>
								<select class="form-control" style="width: 100%;" v-model="siteId=roadSelected2"  id="roadnumber">
									<option :value="road.id" v-for="road in roadList2">{{road.sitenumber}}</option>
								</select>
							</td>

						</tr>
						<tr>
							<td>施工时间</td>
							<td>
								<input type="text" readonly="true" v-model="datetime" id="xgdatetime" placeholder="请输入"style="width: 100%; height: 100%; border: none;">
							</td>
							<td>摊铺里程</td>
							<td>
								<input type="text"  v-model="length" id="length" placeholder="请输入"style="width: 100%; height: 100%; border: none;">
							</td>
						</tr>
					</table>
				</form>  
			</div>
		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			<button type="button" class="btn btn-success" @click="save">保存</button>
		</div>
		</div>
	</div>
</div>
<!-- 修改model结束 -->
</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<script src="../../easyUI/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../easyUI/jquery.easyui.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/jquery.dataTables.min.js"></script>
<script src="../../js/main.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/quanxian.js"></script>
<script src="../../js/layui.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/element.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/echarts.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.staticfile.org/vue-resource/1.5.1/vue-resource.min.js"></script>
<script src="../../toastr/toastr.js"></script>
<script src="../../js/SmartNotification.min.js"></script>
<script src="../../js/myTool.js"></script>
<script>
	$(document).ready( function () {
		laydate.render({
			elem: '#datetime', //指定元素
			type: 'datetime',
			done: function(value, date){
				Tanpulicheng.datetime=value;
			}
		});
		laydate.render({
			elem: '#xgdatetime', //指定元素
			type: 'datetime',
			done: function(value, date){
				xg_Tanpulicheng.datetime=value;
			}
		});
		initTable();
	});

//      ==========================================================折线=======================================================================
        var myChart = echarts.init(document.getElementById('sec'));
 
        var option = {
			    title: {
			        text: '折线图堆叠'
			    },
			    tooltip: {
			        trigger: 'axis'
			    },
			    legend: {
			        data:['2019-08-03','2019-08-02','2019-08-01']
			    },
			    grid: {
			        left: '3%',
			        right: '4%',
			        bottom: '3%',
			        containLabel: true
			    },
			    toolbox: {
			        feature: {
			            saveAsImage: {}
			        }
			    },
			    xAxis: {
			        type: 'category',
			        boundaryGap: false,
			        data: ['2019-08-03','2019-08-02','2019-08-01']
			    },
			    yAxis: {
			        type: 'value'
			    },
			    series: [
			        {
			            name:'邮件营销',
			            type:'line',
			            stack: '总量',
			            data:[120, 132, 101, 134, 90, 230, 210]
			        }
			    ]
			};
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
//===================================================================最后========================================================================
 var myChart = echarts.init(document.getElementById('fou'));
 
        var option = {
				    title: {
				            text: '摊铺里程(km)',
				        },
					color: ['#3398DB'],
				    tooltip : {
				        trigger: 'axis',
				        axisPointer : {            // 坐标轴指示器，坐标轴触发有效
				            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
				        }
				    },
				    grid: {
				        left: '3%',
				        right: '4%',
				        bottom: '3%',
				        containLabel: true
				    },
				    xAxis : [
				        {
				            type : 'category',
				            data : ['连云港汉通路桥养护标段', '宁宿徐养护项目','汾灌高速养护段','沿海高速养护项目'],
				            axisTick: {
				                alignWithLabel: true
				            }
				        }
				    ],
				    yAxis : [
				        {
				            type : 'value'
				        }
				    ],
				    series : [
				        {
				            name:'直接访问',
				            type:'bar',
				            barWidth: '30%',
				            data:[10, 50,100,70]
				        }
				    ]
				};
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
		layui.use('element', function() {
			var $ = layui.jquery,
				element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块

			//触发事件
			var active = {
				tabAdd: function() {
					//新增一个Tab项
					element.tabAdd('demo', {
						title: '新选项' + (Math.random() * 1000 | 0) //用于演示
							,
						content: '内容' + (Math.random() * 1000 | 0),
						id: new Date().getTime() //实际使用一般是规定好的id，这里以时间戳模拟下
					})
				},
				tabDelete: function(othis) {
					//删除指定Tab项
					element.tabDelete('demo', '44'); //删除：“商品管理”


					othis.addClass('layui-btn-disabled');
				},
				tabChange: function() {
					//切换到指定Tab项
					element.tabChange('demo', '22'); //切换到：用户管理
				}
			};

			$('.site-demo-active').on('click', function() {
				var othis = $(this),
					type = othis.data('type');
				active[type] ? active[type].call(this, othis) : '';
			});

			//Hash地址的定位
			var layid = location.hash.replace(/^#test=/, '');
			element.tabChange('test', layid);

			element.on('tab(test)', function(elem) {
				location.hash = 'test=' + $(this).attr('lay-id');
			});

		});
		
		var table=$('#mainContent').dataTable({
		    "deferRender": true,
		    "processing": true,
		    "bDestroy": true,
		    "iDisplayLength": 10,
		    "searching": true,
		    "lengthChange": false,
		    "oLanguage": {
			    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
			},
			"columns": [
				{ "data": "roadName"},
				{ "data": "siteNumber"},
				{ "data": "length"},
				{ "data": "datetime"},
				{ "data": "editUName"},
				{ "data": "id"},
			],
			"columnDefs": [
				{
					"class": "tcenter",
					"targets": 5,
					"searchable": true,
					"render": function(data, type, full) {
						var xiugai='<i class="iconfont icon-xiugai Peadb" style="font-size:18px;cursor:pointer;display:none;" data-f="'+full+'"   onclick="udMsg(this)" title="修改" data-toggle="modal" data-target="#change"></i>'
						var shanchu='<i class="iconfont icon-shanchu Peadc" style="font-size:18px;cursor:pointer;display:none;" data-id="'+data+'" onclick="delMsg(this)" title="删除"></i>'
						return xiugai+shanchu;
					}
				}
			],"fnDrawCallback" : function() {
				$.ajax({
					type:"post",
					url:"/login/getUser",
					async:false,
					data:{
					},
					success:function(json){
						if(json!=null &&json!=""){
							var arr = json.uPermissions.split(',');
							for(var i=0;i<arr.length;i++){
								var arr2 = arr[i].replace("+","");
								if(arr[i].indexOf("Peadb") >= 0 ){
									$(".Peadb").show();
								}
								if(arr[i].indexOf("Peadc") >= 0 ){
									$(".Peadc").show();
								}
							}

						}

					}
				});
			},
		    "order": [[0, 'asc']],
		    "oLanguage": { //国际化配置
		    "sProcessing": "正在获取数据，请稍后...",
		    "sLengthMenu": "显示 _MENU_ 条",
		    "sZeroRecords": "查询不到相关数据",
		    "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
		    "sInfoEmpty": "记录数为0",
		    "sInfoFiltered": "(全部记录数 _MAX_ 条)",
		    "sInfoPostFix": "",
		    "sSearch": "搜索",
		    "sUrl": "",
		    "oPaginate": {
		        "sFirst": "第一页",
		        "sPrevious": "上一页",
		        "sNext": "下一页",
		        "sLast": "最后一页"
		    }},
		    
		});
		function initTable(){
		    $.ajax({
		        type: 'POST',
		        url: '/SiteRoadMileage/selectAllSiteRoadMileage',
		        dataType: 'json',
		        data: {
		        },
		        error: function (msg) {
		            errMessage("请求UserController失败");
		        },
		        success: function (json) {
		            $('#mainContent').dataTable().fnClearTable();
		            $('#mainContent').DataTable().rows.add(json).draw(false);
		        }
		    });
		}



    var Tanpulicheng=new Vue({
        el: '#luruDiv',
        //表单数据
        data: {
			roadid:"",
            datetime:"",
            length:"",
            roadList:'',
			roadList2:'',
			sitenumber:'',
			siteId:'',
        },
        methods:{
            //新建保存按钮事件
            save: function () {
                //发送 post 请求  then中第一个function或者箭头函数为success回调函数, 第二个function为失败fail回调函数
                this.$http.post('/SiteRoadMileage/insertSiteRoadMileage',JSON.stringify(this._data),{}).then((res)=>{
                    var resMsg = res.body;
					if(resMsg.daoMsg>0){
						$("#myModal").modal("hide");
						initTable();
						toastr.success(resMsg.resultMsg);
					}else{
						toastr.error(resMsg.resultMsg);
					}
            },(res)=>{

                });
            },
            roadPost:function(){
                //发送 post 请求  then中第一个function或者箭头函数为success回调函数, 第二个function为失败fail回调函数
                this.$http.post('/TanPuDiDianGuanLi/getIDisroadName',{},{emulateJSON:true}).then((res)=>{
                    this.roadList=res.body;
                    this.roadSelected=Tanpulicheng.roadList[0].roadid;
                    this.roadChange();
            },(res)=>{
                    console.log("初始化失败");
                });
            },
			roadChange:function(){
				this.$http.post('/TanPuDiDianGuanLi/getByLuDuanId',{'roadId':this.roadSelected},{emulateJSON:true}).then((res)=>{
					this.roadList2=res.body;
					this.roadSelected2=Tanpulicheng.roadList2[0].id;
					this.siteId=this.roadSelected2
			},(res)=>{
					console.log("初始化失败");
				});
			}
        }
    })

    //初始化下拉框路段
    Tanpulicheng.roadPost();


		//修改
	function udMsg(obj) {
		var tr = $(obj).parents("tr");
		var data = $("#mainContent").DataTable().row(tr).data();
		xg_Tanpulicheng.id=data.id;
		xg_Tanpulicheng.roadSelected=data.roadId;
		//xg_Tanpulicheng.roadSelected2=data.siteId;
		xg_Tanpulicheng.xg_roadChange(data.siteId)
		xg_Tanpulicheng.datetime=data.datetime;
		xg_Tanpulicheng.length=data.length;

	}

	var xg_Tanpulicheng=new Vue({
		el: '#change',
		//表单数据
		data: {
			id:'',
			roadid:"",
			datetime:"",
			length:"",
			roadList:'',
			roadList2:'',
			sitenumber:'',
			siteId:'',
		},
		methods:{
			//修改保存按钮事件
			save: function () {
				//发送 post 请求  then中第一个function或者箭头函数为success回调函数, 第二个function为失败fail回调函数
				this.$http.post('/SiteRoadMileage/updSiteRoadMileage',JSON.stringify(this._data),{}).then((res)=>{
					var resMsg = res.body;
				if(resMsg.daoMsg>0){
					$("#change").modal("hide");
					initTable();
					toastr.success(resMsg.resultMsg);
				}else{
					toastr.error(resMsg.resultMsg);
				}
			},(res)=>{

				});
			},
			roadPost:function(){
				//发送 post 请求  then中第一个function或者箭头函数为success回调函数, 第二个function为失败fail回调函数
				this.$http.post('/TanPuDiDianGuanLi/getIDisroadName',{},{emulateJSON:true}).then((res)=>{
					this.roadList=res.body;
				this.roadSelected=xg_Tanpulicheng.roadList[0].roadid;
				this.roadChange();
			},(res)=>{
					console.log("初始化失败");
				});
			},
			roadChange:function(){
				this.$http.post('/TanPuDiDianGuanLi/getByLuDuanId',{'roadId':this.roadSelected},{emulateJSON:true}).then((res)=>{
					this.roadList2=res.body;
				this.roadSelected2=xg_Tanpulicheng.roadList2[0].id;
				this.siteId=this.roadSelected2
			},(res)=>{
					console.log("初始化失败");
				});
			},
			xg_roadChange:function(obj){
				this.$http.post('/TanPuDiDianGuanLi/getByLuDuanId',{'roadId':this.roadSelected},{emulateJSON:true}).then((res)=>{
					this.roadList2=res.body;
				this.roadSelected2=obj;
				this.siteId=this.roadSelected2
			},(res)=>{
					console.log("初始化失败");
				});
			},
		}
	})

	//初始化下拉框路段
	xg_Tanpulicheng.roadPost();

	//箭头函数，内部this永远指向父级
	var delMsg = (e)=>{
		var tr = $(e).parents("tr");

		$.SmartMessageBox({
			title: "删除提示",
			content: "确认删除？",
			buttons: '[取消][确定]'
		}, function (ButtonPressed) {
			if (ButtonPressed === "确定") {
				myTool.mask.show('删除中...');
				$.ajax({
					type: 'POST',
					url: '/SiteRoadMileage/delSiteRoadMileage',
					dataType: 'json',
					data: {
						id:$(e).attr("data-id")
					},
					error: function (msg) {
						errMessage("请求UserController失败");
					},
					success: function (json) {
						if(json>0){
							toastr.success("删除成功");
							myTool.mask.hide();
							$('#mainContent').DataTable().row(tr).remove().draw(false); //删除行立即显示
						}else{
							toastr.error("删除失败");
						}
					}
				});

			}
		});
	}

	</script>
</html>