<!DOCTYPE html>
<html>

	<head>
		 <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
   <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../style/jquery-editable-select.css">
	<link rel="stylesheet" type="text/css" href="../../easyUI/themes/default/easyui.css" />
	<link rel="stylesheet" type="text/css" href="../../easyUI/themes/icon.css" />
	<link rel="stylesheet" type="text/css" href="../../easyUI/demo/demo.css" />
	<link rel="stylesheet" type="text/css" href="../../css/layui.css" />
	<link rel="stylesheet" type="text/css" href="../../css/layui.mobile.css" />
	<link rel="stylesheet" type="text/css" href="../../css/laydate.css" />
	<link rel="stylesheet" type="text/css" href="../../css/code.css" />
	<link rel="stylesheet" type="text/css" href="../../../js/skin/default/layer.css" />
    <link rel="stylesheet" type="text/css" href="../../css/laydate.css" />
    <link href="../../toastr/toastr.css" rel="stylesheet">
	    <!-- SmartAdmin Styles : Caution! DO NOT change the order -->
   <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production-plugins.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-skins.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/font.css">
     <!-- SmartAdmin RTL Support  -->
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-rtl.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/all.css">

	</head>

	<body>
	<div class="mianbao">
    	<ul class="breadcrumb">
    		<li><i class="iconfont icon-knowledgebase"></i></li>
			<li>沥青砼生产质量管理</li>
			<li>拌和生产质量监控</li>
			<li class="active">实时生产级配统计</li>
		</ul>
    </div>


		<div class="UpperPartR">

		</div> 
		<div class="layui-tab layui-tab-card layui-tab-brief" lay-filter="docDemoTabBrief">
			<ul class="layui-tab-title">
				<li class="layui-this active">实时级配曲线图</li>
				<!--<li>级配统计图</li>-->
			</ul>
			 
			<div class="layui-tab-content" style="height: 100%;background-color:white;">
				<div class="layui-tab-item layui-show">
				<div class="UpperPart" >
                <div class="UpperPartL" style="z-index:10 !important;">
                    <div class="form-inline" style="margin: 5PX;">
                        <div class="form-group">
                            <input type="text" style="width:200px;margin-left: 15px;" class="form-control" placeholder="起始时间"
                                   id="reservation" onclick="">
                        </div>
                        <span class="form-group" style="padding-top: 5px;margin-left: 5px;margin-right: 5px;">至</span>
                        <div class="form-group">
                            <input type="text" style="width:200px" class="form-control" placeholder="结束时间" id="reservationEnd"><br/>
                        </div>
						<div class="form-group">
							<select  class="form-control" id="time"  style="width: 100%;">

							</select>
						</div>
                      
                        <div class="form-group">
                            <a class="btn btn-primary btn-sm" onclick="searchBydate()">检索</a>
                        </div>
                    </div>
                </div>
                <div class="UpperPartR">

                </div>
            </div>
					<div class="bottom">
						<div id="sec" style="width: 1500px;height:400px;"></div>
					</div>
				</div>
				<!-- 三结束 -->
					<!--<div class="layui-tab-item weadmin-body">
						<div id="fou" style="width: 1500px;height:400px;"></div>
					</div>-->
			</div>
		 </div>
	</body>
	<script src="../../js/jquery.js"></script>
	<script src="../../easyUI/jquery.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../easyUI/jquery.easyui.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/common-scripts.js"></script>
	<script src="../../js/jquery.dataTables.min.js"></script>
	<script src="../../js/main.js"></script>
	<script src="../../js/bootstrap.min.js"></script>
	<script src="../../js/laydate/laydate.js"></script>
	<script src="../../js/layui.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/element.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/echarts.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/myTool.js"></script>
	<script>
		let flag = 0;
		$(document).ready(function () {
			getPeiBiTimeListByTime();
			flag = 1
		});


		let startTime = {
			elem: '#reservation',
			type: 'datetime',
        trigger: 'click',
        done: function (date) {
            let beginDate = date;
            let endDate = $("#reservationEnd").val();
            let d1 = beginDate;
            let d2 = endDate;
            if (beginDate != "" && endDate != "" && d1 > d2) {
                toastr.error("开始时间不能大于结束时间！");
                $("#reservation").val('');
                return false;
            }

        }
    };
    // 结束时间
    let endTime = {
        elem: '#reservationEnd',
        type: 'datetime',
        trigger: 'click',
        done: function (date) {
            let beginDate = $("#reservation").val();
            let endDate = date;
            let d1 = beginDate;
            let d2 = endDate;
            if (beginDate != "" && endDate != "" && d1 > d2) {
                toastr.error("开始时间不能大于结束时间！");
                $("#reservationEnd").val('');
                return false;
            }
			if(flag==1){
				getPeiBiTimeListByTime2(d1,d2)
			}

        }
    };
    laydate.render(startTime);
    laydate.render(endTime);

		function showMask() {
			myTool.mask.show('查询中...');
		}
		function hidMask() {
			myTool.mask.hide();
		}



    function getPeiBiTimeListByTime(){
		showMask()
		$.ajax({
			type: 'POST',
			url: '/QualityByPlateRealTimeProdocutionData/getPeiBiTimeListByTime',
			dataType: 'json',
			data: {
				beginTime:startTime,
				endTime:endTime,
			},
			error: function (msg) {
				errMessage("请求UserController失败");
			},
			success: function (json) {
				$("#time").empty()
				if(json!=null){
					$("#time").append(`<option value=${json[0].productionTime}>${json[0].productionTime}_${json[0].peifangName}</option>`);
				}
				searchBydate()
				hidMask()
			}
		});
	}

		function getPeiBiTimeListByTime2(obj1,obj2){
			$.ajax({
				type: 'POST',
				url: '/QualityByPlateRealTimeProdocutionData/getPeiBiTimeListByTime',
				dataType: 'json',
				data: {
					beginTime:obj1,
					endTime:obj2,
				},
				error: function (msg) {
					errMessage("请求UserController失败");
				},
				success: function (json) {
					$("#time").empty()
					if(json!=null){
						for(var i=0;i<json.length;i++) {
							$("#time").append(`<option value=${json[i].productionTime}>${json[i].productionTime}_${json[i].peifangName}</option>`);
						}
					}
				}
			});
		}



	function searchBydate() {
		var time = $("#time option:selected").text().split("_")[0];
		$.ajax({
			type: 'POST',
			url: '/QualityByPlateRealTimeProdocutionData/getPeiBiOneByTime',
			dataType: 'json',
			data: {
				time: time
			},
			error: function (msg) {
				errMessage("请求UserController失败");
			},
			success: function (json) {
				if(json!=null){
					setEcahrs(json)
				}
			}
		});
	}



	function setEcahrs(obj){
    	var arr=[]
		arr.push(obj.baifenbi1)
		arr.push(obj.baifenbi2)
		arr.push(obj.baifenbi3)
		arr.push(obj.baifenbi4)
		arr.push(obj.baifenbi5)
		arr.push(obj.baifenbi6)
		arr.push(obj.baifenbiFen)
		arr.push(obj.baifenbiLiqing)

		var myChart = echarts.init(document.getElementById('sec'));
		var option = {

			tooltip: {
				trigger: 'axis'
			},
			/*legend: {
				data: ['邮件营销', '联盟广告', '视频广告', '直接访问', '搜索引擎']
			},*/
			grid: {
				left: '3%',
				right: '4%',
				bottom: '3%',
				containLabel: true
			},
			toolbox: {
				feature: {
					saveAsImage: {}
				}
			},
			xAxis: {
				type: 'category',
				boundaryGap: false,
				data: ['0-3', '3-6', '6-11', '11-17', '17-22', '22-32', '粉料比', '沥青比']
			},
			yAxis: {
				type: 'value',
				name: '百分比(%)',
				position: 'left',
			},
			series: [{
				name: '实时生产级配统计',
				type: 'line',
				stack: '总量',
				data: arr
			}
			]
		};
		// 使用刚指定的配置项和数据显示图表。
		myChart.setOption(option);

	}

	
	

	</script>

</html>
