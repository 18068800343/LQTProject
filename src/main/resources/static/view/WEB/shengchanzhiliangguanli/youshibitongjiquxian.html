<!DOCTYPE html>
<html>

	<head>
			 <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
   <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../style/jquery-editable-select.css">
	<link rel="stylesheet" type="text/css" href="../../easyUI/themes/default/easyui.css" />
	<link rel="stylesheet" type="text/css" href="../../easyUI/themes/icon.css" />
	<link rel="stylesheet" type="text/css" href="../../easyUI/demo/demo.css" />
	<link rel="stylesheet" type="text/css" href="../../css/layui.css" />
	<link rel="stylesheet" type="text/css" href="../../css/layui.mobile.css" />
	<link rel="stylesheet" type="text/css" href="../../css/laydate.css" />
	<link rel="stylesheet" type="text/css" href="../../css/code.css" />
	<link rel="stylesheet" type="text/css" href="../../../js/skin/default/layer.css" />
    <link rel="stylesheet" type="text/css" href="../../css/laydate.css" />
    <link href="../../toastr/toastr.css" rel="stylesheet">
	    <!-- SmartAdmin Styles : Caution! DO NOT change the order -->
   <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production-plugins.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-skins.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/font.css">
     <!-- SmartAdmin RTL Support  -->
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-rtl.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/all.css">
		<style lang="">
			 .UpperPart{
            display: flex;
            justify-content:space-between;
            /* border-bottom: 1px solid #ccc; */
            height:0px;
            padding-bottom: 12px;
        }

			.selected {
				background: rgba(247, 161, 3, 0.2);
			}

			#mainContent th {
				cursor: pointer;
			}
		</style>
	</head>
	<body>
	<div class="mianbao">
    	<ul class="breadcrumb">
    		<li><i class="iconfont icon-knowledgebase"></i></li>
			<li>沥青砼生产质量管理</li>
			<li>拌和生产质量监控</li>
			<li class="active">油石比走势</li>
		</ul>
    </div>
 <div class="background" style="background-color:#F0F1F1;width:100%;height:40px;">
    </div>
	<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
		<!-- Nav tabs -->
		<ul class="layui-tab-title" role="tablist" style="background: #fff;">
			<li role="presentation" class="active layui-this">
				<a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">油石比走势</a>
			</li>
			<li role="presentation">
				<a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">油石比走势曲线图</a>
			</li>
		</ul>
		<div class="tab-content" style="margin-top:-10px;">

			<div role="tabpanel" class="tab-pane active" id="profile">
				<div class="zhuti-content">
					<div class="UpperPart">
						<div class="UpperPartL">
							<!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal" style="margin: 5PX;">录入关键筛孔通过率</button> -->
						</div>
						<div class="UpperPartR">
							<!-- <button type="button" class="btn btn-primary" style="margin: 5PX;">导出Excel文件</button> -->
						</div>
					</div>
					<div class="LowerPart" style="margin-top:3px;">
						<table  class="layui-table" lay-skin="line" id="mainContent">
							<thead>
							<tr style="background-color:#EBF4FF;border-bottom:none;background-image:none;">
								<th>计划编号</th>
								<th>时间</th>
								<th>油石比(%)</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<div role="tabpanel" class="tab-pane" id="messages">
				<!--<div class="layui-tab-item weadmin-body">-->
				<div class="zhuti-content">
					<div class="UpperPart">
						<div class="UpperPartL" style="z-index:10 !important;">
							<div class="form-inline" style="margin: 5PX;">
								<div class="form-group">
									<input type="text" style="width:200px;margin-left: 15px;" class="form-control"
										   placeholder="起始时间"
										   id="reservation" onclick="">
								</div>
								<span class="form-group"
									  style="padding-top: 5px;margin-left: 5px;margin-right: 5px;">至</span>
								<div class="form-group">
									<input type="text" style="width:200px" class="form-control" placeholder="结束时间"
										   id="reservationEnd"
										   onclick=""><br/>
								</div>
								<div class="form-group">
									<select class="form-control" id="peifang" style="width: 100%;">
									</select>
								</div>
								<div class="form-group">
									<a class="btn btn-primary btn-sm" onclick="searchBydate()">检索</a>
								</div>

							</div>
						</div>
						<div class="UpperPartR">

						</div>
					</div>
				</div>
				<div class="LowerPart" style="  background-color: #ffffff;margin-top:2%;">
					<!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
					<div id="two" style="width: 1500px;height:600px; margin-left: 5px;" ></div>
				</div>
			</div>
		</div>
	</div>
</body>
<script src="../../js/jquery.js"></script>
<script src="../../easyUI/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/jquery.dataTables.min.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<script src="../../js/main.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/echarts.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/layui.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/element.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/myEcharts.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/myUtil.js" type="text/javascript" charset="utf-8"></script>
<script src="../../toastr/toastr.js"></script>
<script src="../../js/myTool.js"></script>
<script>
	var flag=0
	$(document).ready( function () {
		const start = new Date();
		const end = new Date();
		start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
		end.setTime(end.getTime());
		var startTime = start.Format("yyyy-MM-dd hh:mm:ss");
		var endTime = end.Format("yyyy-MM-dd hh:mm:ss");
		$("#reservation").val(startTime)
		$("#reservationEnd").val(endTime)

		initTable();
		initPeiFangOption();
		searchBydate()
		flag=1
	});

	    var table=$('#mainContent').dataTable({
	        "deferRender": true,
	        "processing": true,
	        "bDestroy": true,
	        "iDisplayLength": 10,
			"searching": true,
			"lengthChange": false,
			"oLanguage": {
				"sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
			},
			"columns": [
				{"data": "planNo"},
				{"data": "nowTime"},
				{"data": "asphaltAggregateRatio"},
			],
			"order": [[1, 'desc']],
			"oLanguage": { //国际化配置
				"sProcessing": "正在获取数据，请稍后...",
				"sLengthMenu": "显示 _MENU_ 条",
				"sZeroRecords": "查询不到相关数据",
				"sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
				"sInfoEmpty": "记录数为0",
				"sInfoFiltered": "(全部记录数 _MAX_ 条)",
				"sInfoPostFix": "",
				"sSearch": "搜索",
				"sUrl": "",
	        "oPaginate": {
	            "sFirst": "第一页",
	            "sPrevious": "上一页",
	            "sNext": "下一页",
	            "sLast": "最后一页"
	        }},
	        
		});

	function showMask() {
		myTool.mask.show('查询中...');
	}
	function hidMask() {
		myTool.mask.hide();
	}
		function initTable(){
			showMask()
	        $.ajax({
	            type: 'POST',
	            url: '/QualityByPlateAsphaltAggregateRatio/getAllQualityByPlateAsphaltAggregateRatio',
	            dataType: 'json',
	            data: {
	            },
	            error: function (msg) {
	                errMessage("请求UserController失败");
	            },
	            success: function (json) {
					hidMask()
	                $('#mainContent').dataTable().fnClearTable();
	                $('#mainContent').DataTable().rows.add(json).draw(false);
	            }
	        });
	    }


	function initPeiBiEcharts(startTime, endTime) {
		$.ajax({
			type: 'POST',
			url: '/QualityByPlateAsphaltAggregateRatio/getYouShiBiVoListByTime',
			dataType: 'json',
			data: {
				beginTime: startTime,
				endTime: endTime,
				peifang: $("#peifang").val(),
			},
			error: function (msg) {
				errMessage("请求UserController失败");
			},
			success: function (json) {
				initMychart(json);
			}
		});
	}

	let startTime = {
		elem: '#reservation',
		type: 'datetime',
		trigger: 'click',
		done: function (date) {
			let beginDate = date;
			let endDate = $("#reservationEnd").val();
			let d1 = beginDate;
			let d2 = endDate;
			if (beginDate != "" && endDate != "" && d1 > d2) {
				toastr.error("开始时间不能大于结束时间！");
				$("#reservation").val('');
				return false;
			}
			if(flag==1){
				initPeiFangOption(d1,d2)
			}
		}
	};
	// 结束时间
	let endTime = {
		elem: '#reservationEnd',
		type: 'datetime',
		trigger: 'click',
		done: function (date) {
			let beginDate = $("#reservation").val();
			let endDate = date;
			let d1 = beginDate;
			let d2 = endDate;
			if (beginDate != "" && endDate != "" && d1 > d2) {
				toastr.error("开始时间不能大于结束时间！");
				$("#reservationEnd").val('');
				return false;
			}
			if(flag==1){
				initPeiFangOption(d1,d2)
			}
		}
	};
	laydate.render(startTime);
	laydate.render(endTime);

	function initPeiFangOption(obj1,obj2) {
		var startime;
		var endtime;
		if(obj1!=""&&obj1!=null&&obj1!=undefined&&obj2!=""&&obj2!=null&&obj2!=undefined){
			startime=obj1;
			endtime=obj2;
		}else{
			startime=$("#reservation").val();
			endtime=$("#reservationEnd").val();
		}
		$.ajax({
			type: 'POST',
			//url: '/SysFormulationManagement/selectAllSysFormulationManagement',
			url: '/ShengChanJiHua/getDISTINCTRecipeIdByFinishTime',
			dataType: 'json',
			data: {
				startime:startime,
				endTime:endtime
			},
			error: function (msg) {
				errMessage("请求UserController失败");
			},
			success: function (json) {
				$("#peifang").empty()
				if (json != null) {
					$("#peifang").append(`<option value="">全部</option>`);
					for (var i = 0; i < json.length; i++) {
						$("#peifang").append(`<option value=${json[i].flId}>${json[i].flName}</option>`);
					}
				}
				//initPeiBiEcharts();
			}
		});
	}

	function searchBydate() {
		let begin = $('#reservation').val();
		let start = begin.replace(/年|月/g, '-').replace('日', '');
		let end = $('#reservationEnd').val().replace(/年|月/g, '-').replace('日', '');
		initPeiBiEcharts(start, end);
		console.log(start);

	}

	function myTrim(x) {
		return x.replace(/^\s+|\s+$/gm, '');
	}

	function initMychart(list) {
		let myChart = echarts.init(document.getElementById('two'));
		// 使用刚指定的配置项和数据显示图表。
		let peibiOption = setYouShiBiOption(list);
		myChart.setOption(peibiOption);
	}


</script>
</html>
