<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
	<link rel="stylesheet" href="../../font2/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
	<link href="../../style/style.css" rel="stylesheet">
	<link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
	<link rel="stylesheet" href="../../style/jquery-editable-select.css">
	<link rel="stylesheet" type="text/css" href="../../easyUI/themes/default/easyui.css"/>
	<link rel="stylesheet" type="text/css" href="../../easyUI/themes/icon.css"/>
	<link rel="stylesheet" type="text/css" href="../../easyUI/demo/demo.css"/>
	<link rel="stylesheet" type="text/css" href="../../css/layui.css"/>
	<link rel="stylesheet" type="text/css" href="../../css/layui.mobile.css"/>
	<link rel="stylesheet" type="text/css" href="../../css/laydate.css"/>
	<link rel="stylesheet" type="text/css" href="../../css/code.css"/>
	<link rel="stylesheet" type="text/css" href="../../../js/skin/default/layer.css"/>
	<link rel="stylesheet" type="text/css" href="../../css/laydate.css"/>
	<link href="../../toastr/toastr.css" rel="stylesheet">
	<!-- SmartAdmin Styles : Caution! DO NOT change the order -->
	<link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production-plugins.min.css">
	<link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production.min.css">
	<link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-skins.min.css">
	<link rel="stylesheet" type="text/css" media="screen" href="../../css/font.css">
	<!-- SmartAdmin RTL Support  -->
	<link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-rtl.min.css">
	<link rel="stylesheet" type="text/css" media="screen" href="../../css/all.css">
	<style lang="">
		body {
			background: #fff;
		}

		.UpperPart {
			display: flex;
			justify-content: space-between;
			border-bottom: 1px solid #ccc;
			padding-bottom: 12px;
		}

		.selected {
			background: rgba(247, 161, 3, 0.2);
		}

		#mainContent th {
			cursor: pointer;
		}
	</style>
</head>
<body>

<!-- 面包屑 -->
<div class="mianbao">
	<ul class="breadcrumb">
		<li>
			<i class="iconfont icon-knowledgebase"></i>
		</li>
		<li>沥青生产质量管理</li>
		<li class="active">当前生产计划管理</li>
	</ul>
</div>
<div class="background" style="background-color:#F0F1F1;width:100%;height:40px;">
</div>
<div>
	<!-- Nav tabs -->
	<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
		<ul class="layui-tab-title" role="tablist" style="background: #fff;">
			<li role="presentation" class="active  layui-this">
				<a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">当前生产计划管理</a>
			</li>

		</ul>
	</div>

	<div class="tab-content">

		<div role="tabpanel" class="tab-pane active" id="profile">
			<div class="zhuti-content">
				<div class="UpperPart" style="">
					<!--<div class="UpperPartL">
						<div style="display:flex;align-items: center;">
							<label>当前生产计划:</label>&nbsp;
							<label id="nowscjh"></label>
						</div>
						<div class="form-group" style="width:800px;margin-top: -15px;">
							<div style="display:flex;align-items: center;">
								<label>设置当前生产计划：</label>
								<select class="form-control" id="scjh" style="width:60%;">

								</select>
								<button type="button" class="btn btn-primary" id="shezhi" style="margin: 5PX;">设置</button>
							</div>
						</div>
					</div>-->
					<div class="UpperPartR">
						<div id="tabBtn" style="margin-left: 10px;margin-top: 1%;"></div>
					</div>
				</div>
				<div class="LowerPart"  name="tbVm">
					<div>
						<table  class="layui-table" lay-skin="line" id="mainContent" style="white-space: nowrap;">
							<thead>
							<tr style="background-color:#EBF4FF;border-bottom:none;background-image:none;">
								<th>生产计划编号</th>
								<th>路段编号</th>
								<th>路段名称</th>
								<th>混合料编号</th>
								<th>成品需要量（每日）</th>
								<th>待生产量</th>
								<th>到场时间要求</th>
								<th>干拌时间</th>
								<th>湿拌时间</th>
								<th>油石比</th>
								<th>成品温度要求</th>
								<th>到现场温度要求</th>
								<th>总价</th>
								<th>日期时间</th>
								<th>录入人</th>
								<th>状态</th>
								<th>操作</th>
							</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
					<!--<div>
						<form class="form-inline">
							<table class="table table-bordered table-condensed" style="height: auto;">
								<tr style="line-height: 40px;height: 40px;">
									<td style="width: 20%;">计划编号</td>
									<td id="jhbh"></td>
									<td>路名</td>
									<td id="lm"></td>
								</tr>
								<tr>
									<td>成品需要量</td>
									<td id="cpxql"></td>
									<td>施工桩号</td>
									<td id="sgzh"></td>
								</tr>
								&lt;!&ndash;<tr style="line-height: 40px;height: 40px;">
									<td>干拌时间</td>
									<td id="gbsj"></td>
									<td>湿拌时间</td>
									<td id="sbsj"></td>
								</tr>&ndash;&gt;
								<tr style="line-height: 40px;height: 40px;">
									<td>成品温度要求</td>
									<td id="cpwdyq"></td>
									<td>到现场温度要求</td>
									<td id="dxcwdyq"></td>
								</tr>
								<tr style="line-height: 40px;height: 40px;">
									<td>油石比</td>
									<td id="ysb"></td>
									<td>单价</td>
									<td id="dj"></td>
								</tr>
								<tr style="line-height: 40px;height: 40px;">
									<td>运输距离</td>
									<td id="ysjl"></td>
									<td>规划高速路径</td>
									<td id="ghgslj"></td>
								</tr>
								<tr style="line-height: 40px;height: 40px;">
									<td>日期时间</td>
									<td id="rqsj"></td>
									<td>生产完成时间</td>
									<td id="scwcsj"></td>
								</tr>
								<tr style="line-height: 40px;height: 40px;">
									<td>路面施工队</td>
									<td id="lmsgd"></td>
									<td></td>
									<td></td>
								</tr>

							</table>
						</form>

					</div>-->
				</div>
			</div>
		</div>


	</div>
</div>



</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../toastr/toastr.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/jquery.dataTables.min.js"></script>
<script src="../../js/jquery-editable-select.js"></script>
<script src="../../easyUI/jquery.easyui.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/main.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<script src="../../js/layui.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/element.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/echarts.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.staticfile.org/vue-resource/1.5.1/vue-resource.min.js"></script>
<script src="../../js/quanxian.js"></script>
<script src="../../js/myUtil.js" type="text/javascript" charset="utf-8"></script>
<!--导出CSV开始-->
<script src="../../js/datatables/jquery.dataTables.min.js"></script>
<script src="../../js/datatables/dataTables.colVis.min.js"></script>
<script src="../../js/datatables/dataTables.tableTools.min.js"></script>
<script src="../../js/datatables/datatables.responsive.min.js"></script>
<script src="../../js/datatables/dataTables.buttons.min.js" ></script>
<script src="../../js/datatables/buttons.html5.min.js" ></script>
<script src="../../js/datatables/buttons.flash.min.js" ></script>
<script src="../../js/datatables/jszip.min.js"></script>
<!--导出CSV结束-->
<script>
	var scjh_now;
	$(document).ready( function () {

		initTable()
	});
	var table=$('#mainContent').DataTable({
		"deferRender": true,
		"processing": true,
		"bDestroy": true,
		"iDisplayLength": 10,
		"searching": true,
		"lengthChange": false,
		"oLanguage": {
			"sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		/*"pagingType": "full_numbers",*/
		"order": [],
		"columns": [
			{"data": "planno"},
			{"data": "roadno", visible: false},
			{"data": "roadname"},
			{"data": "flno"},
			{"data": "pdneed"},
			{"data": "sumneed"},
			{"data": "finishTime"},
			{"data": "drymixingtime"},
			{"data": "wetmixingtime"},
			{"data": "radio"},
			{"data": "pdtemp"},
			{"data": "arrivetemp"},
			{ "data": "zongjia"},
			{ "data": "datetime"},
			{ "data": "uname"},
			{ "data": "planstatecn"},
			{ "data": "planid"},
		],
		"columnDefs": [
			{
				"class": "tcenter",
				"targets": 15,
				"searchable": true,
				"render": function(data, type, full) {
					var finishtime=full.finishTime;

					if(finishtime<scjh_now.finishTime){
						return "已结束"
					}else if(finishtime>scjh_now.finishTime){
						return "未开始";
					}else {
						return "已开始";
					}
				}
			},
			{
				"class": "tcenter",
				"targets": 16,
				"searchable": true,
				"render": function(data, type, full, columnIdx, rowIdx, code ) {
					var kaishi='<i class="glyphicon glyphicon-off Pbeb" style="font-size:18px;cursor:pointer;display:none;"   onclick="kaishi(this)" title="开始" ></i>'
					if(full.finishTime<scjh_now.finishTime||full.finishTime==scjh_now.finishTime){
						return ""
					}else {
						return kaishi;
					}

				}
			},

		],
		"fnDrawCallback" : function() {
			initTableQuanxian()
		},
		//让表格出横向滚动条 ，此时 表头和 表中数据将分为两个部分
		"sScrollX":true,
		// 让表格的宽度不自适应 ，固定宽度。 如果不设置 表头和表中数据会分离
		//表中的数据自适应 ，表头的宽度固定
		"bAutoWidth":false,
		"oLanguage": { //国际化配置
			"sProcessing": "正在获取数据，请稍后...",
			"sLengthMenu": "显示 _MENU_ 条",
			"sZeroRecords": "查询不到相关数据",
			"sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
			"sInfoEmpty": "记录数为0",
			"sInfoFiltered": "(全部记录数 _MAX_ 条)",
			"sInfoPostFix": "",
			"sSearch": "搜索",
			"sUrl": "",
			"oPaginate": {
				"sFirst": "第一页",
				"sPrevious": "上一页",
				"sNext": "下一页",
				"sLast": "最后一页"
			}},
		"buttons": [
			{
				extend: "csv",
				text: "导出Excel",
				bom: true,
				filename: '当前生产计划管理',
				fieldSeparator: ',',
				exportOptions: {
					format: {
						header: function ( data) {
							return data;
						},
						body: function ( data, columnIdx, rowIdx, code ) {
							return data;
						}
					},
					columns:[0,2,3,4,5,6,7,8,9,10,11,12,13,14,15]
				}
			}
		]
	});
	table.buttons().container().appendTo( $('#tabBtn') );
	$('.buttons-csv').addClass('btn btn-primary');

	function initTableQuanxian(){
		$.ajax({
			type:"post",
			url:"/login/getUser",
			async:false,
			data:{
			},
			success:function(json){
				if(json!=null &&json!=""){
					var arr = json.uPermissions.split(',');
					for(var i=0;i<arr.length;i++){
						var arr2 = arr[i].replace("+","");
						if(arr[i].indexOf("Pbed") >= 0 ){
							$(".Pbed").show();
						}
						if(arr[i].indexOf("Pbeb") >= 0 ){
							$(".Pbeb").show();
						}
						if(arr[i].indexOf("Pbec") >= 0 ){
							$(".Pbec").show();
						}
						if(arr[i].indexOf("Pbef") >= 0 ){
							$(".Pbef").show();
						}
						if(arr[i].indexOf("Pbeg") >= 0 ){
							$(".Pbeg").show();
						}
					}

				}

			}
		});
	}
	function initTable(){
		$.ajax({
			type:"post",
			url:"/ShengChanJiHua/getShengChanJiHuaNow",
			async:false,
			data:{
			},
			success:function(json){
				scjh_now=json;
			}
		});
		$.ajax({
			type: 'POST',
			url: '/ShengChanJiHua/getShengChanJiHuaListByFinishTime',
			dataType: 'json',
			data: {
			},
			error: function (msg) {
				errMessage("请求UserController失败");
			},
			success: function (json) {
				$("#mainContent").dataTable().fnClearTable();
				$("#mainContent").DataTable().rows.add(json).draw(false);

			}
		});
	}







	var isNull = (e) =>{
		if(e!=''&&e!=null&&e!=undefined)
			return false;
		return true;
	}


	function kaishi(e){
		var tr=$(e).parents("tr");
		var data=$("#mainContent").DataTable().row(tr).data();
		var msg = "确定要开始该生产计划吗？\n\n请确认！";
		if (confirm(msg) == true){
			console.log(data)
			$.ajax({
				type:"post",
				url:"/ShengChanJiHua/addShengChanJiHuaCurrent",
				data:{
					planId:data.planid,
					planNo:data.planno
				},
				success:function(json){
					if(json>0){
						toastr.success("设置成功")
						initTable()
					}else{
						toastr.error("设置失败")
					}


				}
			});
		}
	}

</script>
</html>